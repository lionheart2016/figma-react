"use strict";var e=require("react"),n=require("./privy-provider-zm0SWrLy.js"),a=require("@solana/spl-token"),t=require("@solana/web3.js"),r=require("@privy-io/js-sdk-core"),o=require("./internal-context-B_aIJuQh.js"),s={id:n.SOLANA_FUNDING_PLUGIN_ID,getBalance:({address:e,cluster:n})=>new t.Connection(r.getSolanaRpcEndpointForCluster(n)).getBalance(new t.PublicKey(e)),getTokenBalance:async({address:e,cluster:n,mintAddress:a})=>await new r.SolanaClient({...n,rpcUrl:r.getSolanaRpcEndpointForCluster(n)}).getTokenAccountsByOwner(e,a)||{amount:BigInt(0),decimals:9},createTransferTransaction:async({from:e,to:n,amount:a,cluster:o})=>{let s=new t.PublicKey(e),i=new t.Transaction;i.add(t.SystemProgram.transfer({fromPubkey:s,toPubkey:new t.PublicKey(n),lamports:a}));let c=new t.Connection(r.getSolanaRpcEndpointForCluster(o)),l=await c.getLatestBlockhash();return i.recentBlockhash=l.blockhash,i.feePayer=s,{transaction:i,connection:c}},createSplTransferTransaction:async({from:e,to:n,amount:o,cluster:s,mintAddress:i})=>{let c=new t.PublicKey(i),l=new t.PublicKey(e),u=new t.PublicKey(n),d=new t.Transaction,p=a.getAssociatedTokenAddressSync(c,l),y=a.getAssociatedTokenAddressSync(c,u);d.add(a.createAssociatedTokenAccountIdempotentInstruction(l,y,u,c)),d.add(a.createTransferInstruction(p,y,l,o));let g=new t.Connection(r.getSolanaRpcEndpointForCluster(s)),w=await g.getLatestBlockhash();return d.recentBlockhash=w.blockhash,d.feePayer=l,{transaction:d,connection:g}},createBridgeTransactionFromRelayQuote:async({quote:e,from:a,cluster:o})=>{let s=e.steps[0]?.items?.[0];if(!s)return;let i=s.data.instructions.map((({keys:e,programId:a,data:r})=>new t.TransactionInstruction({keys:e.map((({pubkey:e,isSigner:n,isWritable:a})=>({pubkey:new t.PublicKey(e),isSigner:n,isWritable:a}))),programId:new t.PublicKey(a),data:n.bufferFrom(r,"hex")}))),c=s.data.addressLookupTableAddresses?.map((e=>new t.PublicKey(e))),l=new t.Connection(r.getSolanaRpcEndpointForCluster(o)),u=await Promise.all((c??[]).map((async e=>l.getAddressLookupTable(e).then((e=>e.value))))),{blockhash:d}=await l.getLatestBlockhash();return{transaction:new t.VersionedTransaction(new t.TransactionMessage({payerKey:new t.PublicKey(a),instructions:i,recentBlockhash:d}).compileToV0Message(u)),connection:l}}};exports.t=s,exports.useFundWallet=a=>{n.usePrivyEventSubscription("fundSolanaWallet",a);let t=n.useAppConfig(),{setModalData:r}=n.usePrivyModal(),{openModal:i}=o.usePrivyInternal();return n.useRegisterPlugin(s),{fundWallet:e.useCallback((async(e,a)=>{r({funding:n.prepareSolanaFundingModalData({address:e,appConfig:t,fundWalletConfig:a,methodScreen:n.FundingMethodSelectionScreen,externalSolanaFundingScreen:n.AwaitingExternalSolanaTransferScreen})}),i(n.FundingMethodSelectionScreen)}),[t,r,i])}};
